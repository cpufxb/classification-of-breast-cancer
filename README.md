# classification-of-breast-cancer
using different way to classify 4 classes about breast cancer
### 项目介绍
####  为了能够得到病理图片上的乳腺癌区域而做的四分类模型。四个类别分别为正常（normal）、良性癌（benign）、原位癌（insitu）、浸润癌（invasive）。
#### 流程
##### 普通cnn模型
- 1、切割图片：patch大小、是否重叠、注意图片保存的格式
- 2、背景区域过滤：去除白色像素点过多的patch
- 3、数据增强：旋转、翻转、颜色增强、模糊、放大缩小
- 4、svs图片的标注：xml文件的读取
- 5、训练模型：lr、bs的选取，
- 6、预测svs图：svs图片的切割以及遍历循环，保存预测得到的结果矩阵
- 7、画结果热图：结合结果矩阵与svs缩略图，画出热图

##### cnn+lstm模型
- 1、切割图片，构建数据集：patch为512x512
- 2、背景区域过滤
- 3、数据增强
- 4、训练cnn分类模型
- 5、获取特征：训练好的cnn模型作为特征提取器，取瓶颈特征作为输入lstm训练的特征。
- 6、用于提取特征的图片：有标签2048x1536的大图，只取中间的1536x1536，共9个patch，即共9个特征，一张大图对应特征有9个。
- 7、预测svs图：舍弃svs图片的512像素边缘，预测一个512x512的patch要裁剪1536x1536大小的patch，要预测的图片在正中央，再把这个大的patch裁剪为9个512x512大小的patch，按顺序输入cnn模型中提取特征，再将特征输入训练好的lstm模型中进行预测。
- 8、画结果热图

##### mil模型
###### 多示例的思想是将一个有粗略标注的图片作为一个bag，从这个bag里面挑选出最有可能是bag对应label的patch作为训练样本，从而使数据更加可信。本项目中的bag是2048x1536的大图，每个bag切512x512的patch，重叠256，一个bag可以有35个样本，从中挑选3个最大概率是bag对应标签的patch作为训练集样本。
###### 每训练一轮都要重新挑选训练集数据
- 1、构建数据集（大图层面）
- 2、挑选数据
- 3、挑选数据的可视化：保存每个patch预测得到的概率并打印到对应的patch上面，并将处理好的patch按照切割的x、y的顺序拼接起来。用一个二值矩阵来保存被挑选patch对应的位置。将拼接图与二值矩阵融合起来，得到对应的可视化图片，被挑选图片会比较亮一些。
- 3、训练模型并保存
- 4、用上一轮保存的模型挑选新的训练集
